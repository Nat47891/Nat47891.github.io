{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2><i class="fas fa-calendar-check"></i> การจองของ {{ space[1] }}</h2>
            <a href="{{ url_for('manage_spaces') }}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> กลับ
            </a>
        </div>
        
        <div class="row">
            <div class="col-md-8">
                <!-- รายการการจอง -->
                {% if bookings %}
                    {% set grouped_bookings = bookings|groupby('3') %}
                    {% for date, date_bookings in grouped_bookings %}
                    <div class="card mb-3">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0">
                                <i class="fas fa-calendar"></i> วันที่ {{ date }}
                                <span class="badge bg-light text-dark ms-2">{{ date_bookings|list|length }} ล็อค</span>
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                {% for booking in date_bookings %}
                                <div class="col-md-6 mb-3">
                                    <div class="booking-item">
                                        <div class="d-flex justify-content-between align-items-start">
                                            <div>
                                                <h6>
                                                    <span class="badge bg-info">{{ booking[3] }}</span>
                                                    {{ booking[7] }} {{ booking[8] }}
                                                </h6>
                                                <p class="mb-1">
                                                    <i class="fas fa-phone"></i> {{ booking[9] }}
                                                </p>
                                                <small class="text-muted">
                                                    จองเมื่อ: {{ booking[6][:16] }}
                                                </small>
                                            </div>
                                            <div>
                                                {% if booking[4] == 'confirmed' %}
                                                    <span class="badge bg-success">ยืนยันแล้ว</span>
                                                {% elif booking[4] == 'pending' %}
                                                    <span class="badge bg-warning">รอชำระ</span>
                                                {% elif booking[4] == 'cancelled' %}
                                                    <span class="badge bg-danger">ยกเลิก</span>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                <div class="card">
                    <div class="card-body text-center">
                        <i class="fas fa-calendar-times" style="font-size: 3rem; color: #cbd5e0;"></i>
                        <h4 class="mt-3">ยังไม่มีการจอง</h4>
                        <p>ยังไม่มีใครจองสถานที่นี้</p>
                    </div>
                </div>
                {% endif %}
            </div>
            
            <div class="col-md-4">
                <!-- ข้อมูลสถานที่ -->
                <div class="card mb-3">
                    <div class="card-header">
                        <h6 class="mb-0"><i class="fas fa-info-circle"></i> ข้อมูลสถานที่</h6>
                    </div>
                    <div class="card-body">
                        <p><strong>ชื่อ:</strong> {{ space[1] }}</p>
                        <p><strong>ที่อยู่:</strong> {{ space[2] }}</p>
                        <p><strong>ขนาด:</strong> {{ space[3] }}</p>
                        <p><strong>ราคา:</strong> {{ space[4] }} บาท/ล็อค/วัน</p>
                        <p><strong>วันที่เปิด:</strong> {{ space[5] }}</p>
                        <p><strong>เวลา:</strong> {{ space[6] }}</p>
                    </div>
                </div>
                
                <!-- สถิติการจอง -->
                <div class="card">
                    <div class="card-header">
                        <h6 class="mb-0"><i class="fas fa-chart-bar"></i> สถิติการจอง</h6>
                    </div>
                    <div class="card-body">
                        <div class="stats-item mb-2">
                            <div class="d-flex justify-content-between">
                                <span>ยืนยันแล้ว:</span>
                                <span class="badge bg-success">{{ bookings|selectattr('4', 'equalto', 'confirmed')|list|length }}</span>
                            </div>
                        </div>
                        <div class="stats-item mb-2">
                            <div class="d-flex justify-content-between">
                                <span>รอชำระ:</span>
                                <span class="badge bg-warning">{{ bookings|selectattr('4', 'equalto', 'pending')|list|length }}</span>
                            </div>
                        </div>
                        <div class="stats-item mb-2">
                            <div class="d-flex justify-content-between">
                                <span>ยกเลิก:</span>
                                <span class="badge bg-danger">{{ bookings|selectattr('4', 'equalto', 'cancelled')|list|length }}</span>
                            </div>
                        </div>
                        <hr>
                        <div class="stats-item">
                            <div class="d-flex justify-content-between">
                                <strong>รวมทั้งหมด:</strong>
                                <strong class="badge bg-primary">{{ bookings|length }}</strong>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.booking-item {
    border: 1px solid #dee2e6;
    border-radius: 8px;
    padding: 10px;
    background: #f8f9fa;
}

.stats-item {
    padding: 5px 0;
}
</style>
{% endblock %}